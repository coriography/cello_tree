{% extends 'base.html' %}

{% block body %}
<div class="bkg-img" style="background-image: url(/static/img/tree_2.jpg); top: 0"></div>
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="profile-header text-white position-relative box-shadow-sm mb-5">
                <div class="profile-header-overlay"></div>
                <div class="row">
                    <div class="col-12 col-md-8">
                        <div class="profile-inner-container">
                            <div class="row">
                                <div class="col-12">
                                    <div class="profile-name-container mb-5">
                                        <h1>{{cellist.fname}}<br>{{cellist.lname}}</h1>
                                    </div>
                                </div>
                                <div class="col-4 pr-0">
                                    <p class="card-text">4 <br><small class="">teachers</small></p>
                                </div>
                                <div class="col-4 pr-0">
                                    <p class="card-text">5 <br><small class="">students</small></p>
                                </div>
                                <div class="col-4">
                                    <p class="card-text">25 <br><small class="">posts</small></p>
                                </div>
                            </div>
                            <div class="row">
                                {% if 'user_id' in session %}
                                <div class="col-12">
                                    <button class="btn btn-secondary border-white mb-3" data-toggle="modal" data-target="#updateModal">
                                        <i class="fas fa-edit mr-1"></i>
                                        Edit profile
                                    </button>
                                </div>
                                {% endif %}
                                <div class="col-12">
                                    {% if cellist.music_url %}
                                    <a href="{{cellist.music_url}}" target="_blank" class="btn btn-secondary border-white mb-3">
                                        <i class="fas fa-music mr-1"></i>
                                        Listen now
                                        <i class="fas fa-external-link-alt ml-1"></i>
                                    </a>
                                    {% endif %}
                                </div>
                                <div class="col-12">
                                    {% if cellist.cello_details %}
                                    <p>Instrument: {{cellist.cello_details}}</p>
                                    {% endif %}
                                </div>
                                <div class="col-12">
                                    {% if editor != None %}
                                    <small>last edited by: <span id="last_edited">{{editor.username}}</span></small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        {% if cellist.img_url %}
                        <div class="cellist-card-img" style="background-image: url('{{cellist.img_url}}')"></div>
                        {% else %}
                        <div class="cellist-card-img" style="background-image: url('/static/img/cello_1.jpg')"></div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    <div class="row">
        <div class="col-12 col-md-10 offset-1">

            <div class="profile-section tree-section position-relative box-shadow-sm mb-5">
                <div class="profile-section-overlay"></div>
                <div class="row">
                    <div class="col-12">
                        <h2>The Tree</h2>
                        <p>Tip: click, pan, and zoom to explore the branches of the tree!</p>
                        <p id="root_cellist_id" data-id="{{cellist.cellist_id}}"></p>
                        <div id="double_tree_container"></div>

                        <div  class="profile-inner-container">
                            <h5>Add a branch to this tree</h5>
                            {% if 'user_id' in session %}
                            <form id="add_link">
                                <div class="form-group d-flex">
                                    <div class="">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="teacher_checked" checked>
                                            <label class="form-check-label" for="teacher_checked">
                                                Add a teacher of {{cellist.fname}} {{cellist.lname}}
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="" id="student_checked">
                                            <label class="form-check-label" for="student_checked">
                                                Add a student of {{cellist.fname}} {{cellist.lname}}
                                            </label>
                                        </div>
                                    </div>
                                    <div class="ml-3">
                                        <select name="teacher_id_select" class="form-control" id="teacher_id" required>
                                            {% for c_option in all_cellists %}
                                            <option value="{{c_option.cellist_id}}">{{c_option.lname}}, {{c_option.fname}}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="ml-3">
                                        <input id="student_id" type="hidden" placeholder="student id"
                                        value="{{cellist.cellist_id}}">
                                        <input type="submit" class="form-control btn btn-primary">
                                    </div>
                                </div>

                            </form>

                            <p id="add_link_response"></p>

                            <div class="mt-5">
                                <p class="small d-inline">Don't see who you're looking for?</p>
                                <a href="/add_cellist" class="btn btn-secondary ml-3 d-inline">
                                    <span class="fa fa-plus"></span>
                                    Add cellist to database
                                </a>
                            </div>
                            
                            {% else %}
                            <p>Please <a href="/">log in</a> to add a teacher.</p>
                            {% endif %}
                        </div>

                    </div>
                </div>
            </div>

            {% if cellist.bio %}
            <div class="profile-section position-relative box-shadow-sm mb-5">
                <div class="profile-section-overlay"></div>
                <div class="profile-inner-container">
                    <h3>About {{cellist.fname}} {{cellist.lname}}</h3>
                    <p>{{cellist.bio}}</p>
                </div>
            </div>
            {% endif %}

            <div class="profile-section position-relative box-shadow-sm mb-5">
                <div class="profile-section-overlay"></div>
                <div class="profile-inner-container">
                    <h4>Forum</h4>
                    <form id="add_post">
                        {% if 'user_id' in session %}
                        <input id="cellist_id_from_profile" type="hidden" value="{{cellist.cellist_id}}" class="form-control">
                        <div class="form-group form-row">
                            <textarea id="post_content" rows="4" class="w-100">your post here</textarea>
                            
                        </div>
                        <div class="form-group form-row">
                            <input type="submit" class="btn btn-primary form-control" style="max-width: 100px;">
                        </div>
                        
                        {% else %}
                        <p>Please <a href="/">log in</a> to add a post.</p>
                        {% endif %}
                    </form>

                    {% if posts %}
                    <div id="profile_forum">
                        {% for post in posts %}
                        <div class="py-4">
                            <h5>{{post.user.username}}</h5>
                            <h6>{{post.post_date.strftime('%b. %d, %Y, %H:%M')}} UTC</h6>
                            <p>{{post.content}}</p>
                            <p>
                                <i id="upvote_icon_{{post.post_id}}" class="fas fa-arrow-alt-circle-up"></i>
                                <span id="upvotes_count_{{post.post_id}}" class="">
                                    {{post.upvotes|length}} upvotes
                                </span>
                            </p>
                            
                            {% if 'user_id' in session %}
                            <button id="toggle_upvote_{{post.post_id}}" class="btn btn-secondary"
                                onclick="toggleUpvote(`{{post.post_id}}`)">
                                Upvote
                            </button>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p>Be the first one to post!</p>
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</div>


<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Update {{cellist.fname}} {{cellist.lname}}'s profile</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="update_cellist">
                    
                    <input type="hidden" id="update_cellist_id" value="{{cellist.cellist_id}}" class="form-control">
                    <div class="form-group form-row">
                        <div class="col-6">
                            <label for="update_fname">First Name</label>
                            <input type="text" id="update_fname" value="{{cellist.fname}}" class="form-control">
                        </div>
                        <div class="col-6">
                            <label for="update_lname">Last Name</label>
                            <input type="text" id="update_lname"  value="{{cellist.lname}}" class="form-control">
                        </div>
                    </div>
                    <div class="form-group form-row">
                        <label for="update_music_url">Website or music URL</label>
                        <input type="text" id="update_music_url"  value="{{cellist.music_url}}" class="form-control">
                    </div>
                    <div class="form-group form-row">
                        <label for="update_cello_details">Cello details</label>
                        <textarea id="update_cello_details" value="{{cellist.cello_details}}" class="form-control">{{cellist.cello_details}}</textarea>
                    </div>
                    <div class="form-group form-row">
                        <label for="update_bio">Bio</label>
                        <textarea id="update_bio" value="{{cellist.bio}}" maxlength="500" class="form-control">{{cellist.bio}}</textarea>
                    </div>
                    <div class="form-group form-row">
                        {% if cellist.img_url %}
                        <img src="{{cellist.img_url}}" style="max-height: 100px;" alt="current cellist photo">
                        {% else %}
                        <p>This profile does not have a photo yet. Add one!</p>
                        {% endif %}
                    </div>
                    <div class="form-group form-row">
                        <label for="update_photo">Photo</label>
                        <input type="file" id="update_photo" class="form-control" value="{{cellist.img_url}}">
                    </div>
                    <div class="form-group form-row">
                        <input type="submit" class="btn btn-primary">
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script src="/static/tree_class.js"></script>
<script src="/static/oop_asc_desc.js"></script>

{% endblock %}